---
title: "Today's Top Hits - Audio Visualizer"
format: 
  dashboard: 
    logo: "image/logo.png"
    orientation: columns
    theme: [dark, slate]
    viewer-height: 100vh
    css: |
      body, html, #quarto-dashboard {
        background-color: #000000 !important;
        color: #ffffff !important;
      }
      .dashboard-card, .cell-output {
        background-color: #121226 !important;
        color: #ffffff !important;
      }
---
<!-- For√ßar tema escuro globalmente -->
<style>
  :root {
    --bs-body-bg: #000000 !important;
    --bs-body-color: #ffffff !important;
  }
  body, html, #quarto-dashboard, .dashboard-grid, .cell-output {
    background-color: #000000 !important;
    color: #ffffff !important;
  }
  .card, .dashboard-card, .viz-card, .album-card {
    background-color: #1a1a3a !important;
    color: #ffffff !important;
    border: 1px solid #333 !important;
  }
</style>

<!-- Incluir suas bibliotecas -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<!-- SISTEMA COMPLETO COM CONTROLES DE REPRODU√á√ÉO CORRIGIDO -->
<script type="module">
// IMPORTAR APENAS AS CLASSES ESSENCIAIS
import { AudioProcessor } from "./js/AudioProcessor.js";
import { VisualizationEngine } from "./js/VisualizationEngine.js";

// AudioProcessor melhorado com controles de tempo usando Audio Element
class EnhancedAudioProcessor extends AudioProcessor {
  constructor() {
    super();
    this.currentTime = 0;
    this.duration = 0;
    this.isPaused = false;
    this.audioElement = null;
    this.audioBuffer = null;
    this.isSeeking = false;
    this.seekTime = 0;
    this.isLoaded = false;
    this.pendingSeekTime = null;
  }

  async loadPredefinedAudio(url) {
    this.stop();
    
    if (this.audioContext.state !== "running") {
      await this.audioContext.resume();
    }
    
    try {
      console.log("Tentando carregar:", url);
      
      let audioUrl = url;
      if (!url.startsWith('http') && !url.startsWith('./') && !url.startsWith('/')) {
        audioUrl = './' + url;
      }
      
      const response = await fetch(audioUrl);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const arrayBuffer = await response.arrayBuffer();
      
      if (arrayBuffer.byteLength === 0) {
        throw new Error("Arquivo est√° vazio (0 bytes)");
      }
      
      console.log("Tamanho do arquivo:", arrayBuffer.byteLength, "bytes");
      
      this.useAudioElement = true;
      this.audioElement = new Audio();
      
      const blob = new Blob([arrayBuffer], { type: 'audio/mpeg' });
      const blobUrl = URL.createObjectURL(blob);
      this.audioElement.src = blobUrl;
      
      return new Promise((resolve, reject) => {
        this.audioElement.onloadedmetadata = () => {
          this.duration = this.audioElement.duration;
          console.log("Dura√ß√£o do √°udio:", this.duration, "segundos");
          
          this.source = this.audioContext.createMediaElementSource(this.audioElement);
          this.gainNode = this.audioContext.createGain();
          this.gainNode.gain.value = 1.0;
          
          this.source.connect(this.gainNode);
          this.gainNode.connect(this.analyser);
          this.analyser.connect(this.audioContext.destination);
          
          // Configurar evento de tempo atualizado
          this.audioElement.ontimeupdate = () => {
            if (!this.isSeeking) {
              this.currentTime = this.audioElement.currentTime;
            }
          };
          
          // Configurar evento de t√©rmino
          this.audioElement.onended = () => {
            console.log("√Åudio terminou naturalmente");
            this.isPlaying = false;
            this.isPaused = false;
            this.currentTime = 0;
          };
          
          this.audioElement.onerror = (e) => {
            console.error("Erro no Audio Element:", this.audioElement.error);
            reject(new Error(`Erro no √°udio: ${this.audioElement.error?.message || 'Desconhecido'}`));
          };
          
          this.isLoaded = true;
          
          if (this.pendingSeekTime !== null) {
            console.log(`Aplicando seek pendente: ${this.pendingSeekTime}s`);
            this.seekTo(this.pendingSeekTime);
            this.pendingSeekTime = null;
          }
          
          URL.revokeObjectURL(blobUrl);
          resolve();
        };
        
        this.audioElement.onerror = (e) => {
          console.error("Erro ao carregar √°udio:", this.audioElement.error);
          URL.revokeObjectURL(blobUrl);
          reject(new Error(`Erro ao carregar √°udio: ${this.audioElement.error?.message || 'Desconhecido'}`));
        };
        
        setTimeout(() => {
          if (!this.duration) {
            URL.revokeObjectURL(blobUrl);
            reject(new Error("Timeout ao carregar √°udio"));
          }
        }, 10000);
      });
      
    } catch (error) {
      console.error("Erro completo no loadPredefinedAudio:", error);
      throw new Error(`Erro ao carregar √°udio: ${error.message}`);
    }
  }

  // M√âTODO CORRIGIDO: togglePlayPause que sempre funciona
  togglePlayPause() {
    return new Promise((resolve, reject) => {
      if (!this.audioElement) {
        reject(new Error("Nenhum √°udio carregado"));
        return;
      }
      
      const wasPlaying = this.isPlaying && !this.isPaused;
      
      if (wasPlaying) {
        // PAUSAR
        console.log("Pausando √°udio...");
        const success = this.pause();
        if (success) {
          resolve({ action: "pause", success: true });
        } else {
          reject(new Error("Falha ao pausar"));
        }
      } else {
        // TOCAR ou RETOMAR
        console.log("Tocando/retomando √°udio...");
        this.play().then(success => {
          if (success) {
            resolve({ action: "play", success: true });
          } else {
            reject(new Error("Falha ao iniciar reprodu√ß√£o"));
          }
        }).catch(reject);
      }
    });
  }

  // M√©todo play corrigido
  play() {
    if (!this.audioElement) return Promise.resolve(false);
    
    return this.audioElement.play().then(() => {
      this.isPlaying = true;
      this.isPaused = false;
      
      if (this.audioContext.state === 'suspended') {
        this.audioContext.resume();
      }
      
      console.log("√Åudio iniciado com sucesso");
      return true;
    }).catch(error => {
      console.error("Erro ao tocar:", error);
      this.isPlaying = false;
      this.isPaused = false;
      return false;
    });
  }

  // M√©todo pause corrigido
  pause() {
    if (this.audioElement && this.isPlaying && !this.isPaused) {
      this.audioElement.pause();
      this.isPlaying = false;
      this.isPaused = true;
      console.log("√Åudio pausado");
      return true;
    }
    return false;
  }

  async seekTo(time) {
    if (!this.isLoaded || !this.audioElement) {
      console.log(`√Åudio n√£o carregado. Armazenando seek pendente: ${time}s`);
      this.pendingSeekTime = time;
      return false;
    }
    
    if (this.duration > 0) {
      const validTime = Math.max(0, Math.min(time, this.duration));
      this.isSeeking = true;
      this.audioElement.currentTime = validTime;
      this.currentTime = validTime;
      
      if (this.isPlaying && !this.isPaused) {
        setTimeout(() => {
          this.isSeeking = false;
        }, 100);
      } else {
        this.isSeeking = false;
      }
      
      console.log(`Seek para: ${validTime}s`);
      return true;
    }
    return false;
  }

  getCurrentTime() {
    if (this.audioElement) {
      return this.audioElement.currentTime;
    }
    return this.currentTime;
  }

  getProgress() {
    if (this.duration > 0) {
      const current = this.getCurrentTime();
      return Math.min(100, (current / this.duration) * 100);
    }
    return 0;
  }

  getEstimatedDuration() {
    if (this.duration > 0) return this.duration;
    const estimatedDurations = [208, 224, 250];
    return estimatedDurations[0] || 180;
  }

  restart() {
    if (this.audioElement) {
      this.audioElement.currentTime = 0;
      this.currentTime = 0;
      
      if (this.isPlaying && !this.isPaused) {
        this.audioElement.play();
      }
      return true;
    }
    return false;
  }

  isAudioLoaded() {
    return this.isLoaded && this.audioElement !== null;
  }

  stop() {
    if (this.audioElement) {
      this.audioElement.pause();
      this.audioElement.currentTime = 0;
    }
    
    super.stop();
    
    this.currentTime = 0;
    this.isPaused = false;
    this.isSeeking = false;
    this.isLoaded = false;
    this.pendingSeekTime = null;
  }

  update() {
    if (this.isPlaying && !this.isPaused && this.analyser) {
      this.analyser.getByteFrequencyData(this.frequencyData);
      this.analyser.getByteTimeDomainData(this.waveformData);
    } else {
      this.frequencyData.fill(0);
      this.waveformData.fill(128);
    }
  }
}

// Sistema simplificado para m√∫ltiplos players - CORRIGIDO
class AudioPlayer {
  constructor(canvasId, albumKey, albumIndex) {
    this.canvas = document.getElementById(canvasId);
    this.albumKey = albumKey;
    this.albumIndex = albumIndex;
    
    if (!this.canvas) {
      console.error(`Canvas ${canvasId} n√£o encontrado`);
      return;
    }
    
    this.audioProcessor = new EnhancedAudioProcessor();
    this.visualizationEngine = new VisualizationEngine(this.canvas);
    this.visualizationEngine.setAudioProcessor(this.audioProcessor);
    
    this.animationFrameId = null;
    this.currentTrack = null;
    this.progressInterval = null;
    this.isDraggingProgress = false;
    this.lastProgressValue = 0;
    this.hasBeenLoaded = false;
    this.isLoading = false;
    this.pendingSeekAfterLoad = null;
    
    // Dura√ß√µes estimadas para cada √°lbum (em segundos)
    this.estimatedDurations = [208, 224, 250];
    
    // VERIFICA√á√ÉO PERI√ìDICA DO ESTADO
    this.statusCheckInterval = null;
    
    this.init();
  }
  
  init() {
    this.visualizationEngine.setVisualization("spectrum");
    this.startRender();
    this.startProgressUpdate();
    this.setupProgressBarEvents();
    this.setupPlayPauseButton();
    
    // INICIAR VERIFICA√á√ÉO PERI√ìDICA
    this.startStatusCheck();
  }
  
  startStatusCheck() {
    this.statusCheckInterval = setInterval(() => {
      this.updatePlayPauseButton();
      this.updateProgressDisplay();
    }, 100);
  }
  
  async loadAndPlayAlbum(startTime = 0) {
    try {
      if (this.isLoading) {
        console.log(`J√° est√° carregando ${this.albumKey}`);
        return false;
      }
      
      this.isLoading = true;
      this.stop();
      
      const track = window.AudioDashboard?.trackList[this.albumIndex];
      if (!track) {
        console.error(`Track n√£o encontrada para √≠ndice ${this.albumIndex}`);
        this.isLoading = false;
        return false;
      }
      
      console.log(`Carregando: ${track.name}${startTime > 0 ? ` come√ßando em ${startTime}s` : ''}`);
      
      await this.audioProcessor.loadPredefinedAudio(track.path);
      this.currentTrack = track.path;
      this.hasBeenLoaded = true;
      this.isLoading = false;
      
      if (startTime > 0) {
        console.log(`Iniciando do tempo ${startTime}s`);
        await this.audioProcessor.seekTo(startTime);
      }
      
      const success = await this.audioProcessor.play();
      
      if (success) {
        console.log(`Reproduzindo: ${track.name}${startTime > 0 ? ` a partir de ${startTime}s` : ''}`);
        this.updatePlayPauseButton();
        return true;
      }
      
      return false;
      
    } catch (error) {
      console.error(`Erro ao carregar e tocar √°lbum ${this.albumKey}:`, error);
      this.isLoading = false;
      this.showError(`Erro ao carregar m√∫sica: ${error.message}`);
      return false;
    }
  }
  
  async smartPlayPause(startTime = 0) {
    // Se n√£o tem √°udio carregado, carrega e toca
    if (!this.audioProcessor.isAudioLoaded() || !this.hasBeenLoaded) {
      console.log(`√Ålbum ${this.albumKey} n√£o carregado. Carregando...`);
      return await this.loadAndPlayAlbum(startTime);
    }
    
    // Se j√° tem √°udio carregado, alterna play/pause
    console.log(`Alternando play/pause para ${this.albumKey}`);
    
    try {
      await this.audioProcessor.togglePlayPause();
      this.updatePlayPauseButton(); // ATUALIZAR ICONE IMEDIATAMENTE
      return true;
    } catch (error) {
      console.error("Erro ao alternar play/pause:", error);
      return false;
    }
  }
  
  // M√âTODO REMOVIDO: togglePlayPause n√£o √© mais usado diretamente
  
  restart() {
    if (this.audioProcessor) {
      this.audioProcessor.restart();
      this.updatePlayPauseButton();
    }
  }
  
  async seekTo(time) {
    if (this.audioProcessor.duration > 0) {
      return this.audioProcessor.seekTo(time);
    }
    return false;
  }
  
  stop() {
    this.audioProcessor.stop();
    this.currentTrack = null;
    this.hasBeenLoaded = false;
    this.updatePlayPauseButton();
  }
  
  setVisualization(type) {
    return this.visualizationEngine.setVisualization(type);
  }
  
  startRender() {
    const update = () => {
      this.audioProcessor.update();
      
      if (this.audioProcessor.isPlaying && !this.audioProcessor.isPaused) {
        this.visualizationEngine.draw();
      } else {
        this.visualizationEngine.clearCanvas();
      }
      
      this.animationFrameId = requestAnimationFrame(update);
    };
    
    this.animationFrameId = requestAnimationFrame(update);
  }
  
  startProgressUpdate() {
    this.progressInterval = setInterval(() => {
      if (!this.isDraggingProgress) {
        this.updateProgressDisplay();
      }
    }, 100);
  }
  
  // M√âTODO CORRIGIDO: Barra de progresso funcional ANTES do play
  setupProgressBarEvents() {
    const progressBar = document.getElementById(`progressBar-${this.albumKey}`);
    const progressFill = document.getElementById(`progressFill-${this.albumKey}`);
    
    if (!progressBar) return;
    
    // 1. Atualizar visual imediatamente
    const updateProgressVisual = (value) => {
      if (progressFill) {
        progressFill.style.width = `${value}%`;
      }
      progressBar.value = value;
    };
    
    // 2. Obter tempo estimado baseado no √≠ndice do √°lbum
    const getEstimatedTimeFromProgress = (progress) => {
      const estimatedDuration = this.estimatedDurations[this.albumIndex] || 180;
      return (progress / 100) * estimatedDuration;
    };
    
    // 3. Evento de INPUT (enquanto arrasta) - mostra tempo estimado
    progressBar.addEventListener('input', (e) => {
      this.isDraggingProgress = true;
      const progress = parseFloat(e.target.value);
      const time = getEstimatedTimeFromProgress(progress);
      
      updateProgressVisual(progress);
      
      const currentTimeEl = document.getElementById(`currentTime-${this.albumKey}`);
      if (currentTimeEl) {
        currentTimeEl.textContent = this.formatTime(time);
      }
    });
    
    // 4. Evento de CHANGE (quando solta) - CARREGA E TOCA DO PONTO
    progressBar.addEventListener('change', async (e) => {
      const progress = parseFloat(e.target.value);
      const time = getEstimatedTimeFromProgress(progress);
      
      console.log(`Soltou barra em ${progress}% (${time}s)`);
      
      // Se J√Å EST√Å TOCANDO, apenas busca
      if (this.audioProcessor.isAudioLoaded() && 
          this.audioProcessor.isPlaying && 
          !this.audioProcessor.isPaused) {
        await this.audioProcessor.seekTo(time);
      } 
      // Se N√ÉO est√° carregado, carrega e toca do ponto
      else {
        console.log(`Carregando e tocando do tempo ${time}s...`);
        
        const currentTimeEl = document.getElementById(`currentTime-${this.albumKey}`);
        if (currentTimeEl) currentTimeEl.textContent = "Loading...";
        
        await this.loadAndPlayAlbum(time);
      }
      
      this.isDraggingProgress = false;
    });
    
    // 5. Evento de CLICK na barra (funciona SEMPRE)
    const progressContainer = progressBar.parentElement;
    if (progressContainer) {
      progressContainer.addEventListener('click', async (e) => {
        if (e.target !== progressBar) {
          const rect = progressContainer.getBoundingClientRect();
          const clickPosition = e.clientX - rect.left;
          const percentage = (clickPosition / rect.width) * 100;
          const time = getEstimatedTimeFromProgress(percentage);
          
          console.log(`Click na barra: ${percentage}% (${time}s)`);
          
          updateProgressVisual(percentage);
          
          const currentTimeEl = document.getElementById(`currentTime-${this.albumKey}`);
          if (currentTimeEl) {
            currentTimeEl.textContent = this.formatTime(time);
          }
          
          // Carregar/tocar do ponto clicado
          await this.handlePlayFromTime(time);
        }
      });
    }
  }
  
  // NOVO: M√©todo para tocar a partir de um tempo
  async handlePlayFromTime(time) {
    // Se j√° est√° tocando, apenas busca
    if (this.audioProcessor.isAudioLoaded() && 
        this.audioProcessor.isPlaying && 
        !this.audioProcessor.isPaused) {
      return this.audioProcessor.seekTo(time);
    }
    // Se est√° pausado, busca e toca
    else if (this.audioProcessor.isAudioLoaded() && this.audioProcessor.isPaused) {
      await this.audioProcessor.seekTo(time);
      return this.audioProcessor.play();
    }
    // Se n√£o est√° carregado, carrega e toca do tempo
    else {
      return this.loadAndPlayAlbum(time);
    }
  }
  
  // M√âTODO CORRIGIDO: Bot√£o Play/Pause atualizado
  setupPlayPauseButton() {
    const playPauseBtn = document.getElementById(`playPauseBtn-${this.albumKey}`);
    if (!playPauseBtn) return;
    
    // Remover event listener anterior
    const newBtn = playPauseBtn.cloneNode(true);
    playPauseBtn.parentNode.replaceChild(newBtn, playPauseBtn);
    
    // Adicionar novo event listener
    newBtn.addEventListener('click', async () => {
      console.log(`Bot√£o Play/Pause clicado para ${this.albumKey}`);
      await this.smartPlayPause();
    });
  }
  
  updateProgressDisplay() {
    const progressBar = document.getElementById(`progressBar-${this.albumKey}`);
    const progressFill = document.getElementById(`progressFill-${this.albumKey}`);
    const currentTimeEl = document.getElementById(`currentTime-${this.albumKey}`);
    const totalTimeEl = document.getElementById(`totalTime-${this.albumKey}`);
    
    if (progressBar && this.audioProcessor) {
      let progress;
      let currentTime;
      let totalTime;
      
      if (this.audioProcessor.isAudioLoaded()) {
        progress = this.audioProcessor.getProgress();
        currentTime = this.audioProcessor.getCurrentTime();
        totalTime = this.audioProcessor.duration || 0;
      } else {
        progress = 0;
        currentTime = 0;
        totalTime = this.estimatedDurations[this.albumIndex] || 180;
      }
      
      if (!this.isDraggingProgress) {
        progressBar.value = progress;
        if (progressFill) {
          progressFill.style.width = `${progress}%`;
        }
      }
      
      if (currentTimeEl) {
        currentTimeEl.textContent = this.formatTime(currentTime);
      }
      
      if (totalTimeEl) {
        totalTimeEl.textContent = this.formatTime(totalTime);
      }
    }
  }
  
  // M√âTODO CORRIGIDO: Atualiza√ß√£o correta do bot√£o Play/Pause
  updatePlayPauseButton() {
    const playPauseBtn = document.getElementById(`playPauseBtn-${this.albumKey}`);
    if (!playPauseBtn) return;
    
    const icon = playPauseBtn.querySelector('i');
    if (!icon) return;
    
    // VERIFICA√á√ÉO CORRETA do estado
    const isActuallyPlaying = this.audioProcessor.isPlaying && !this.audioProcessor.isPaused;
    
    if (isActuallyPlaying) {
      // MUDAR PARA PAUSA
      icon.className = 'bi bi-pause-fill';
      icon.style.marginLeft = '0px';
      playPauseBtn.title = "Pause";
      playPauseBtn.style.background = '#f72585';
      playPauseBtn.style.boxShadow = '0 2px 8px rgba(247, 37, 133, 0.3)';
    } else {
      // MUDAR PARA PLAY
      icon.className = 'bi bi-play-fill';
      icon.style.marginLeft = '2px';
      playPauseBtn.title = "Play";
      playPauseBtn.style.background = '#4cc9f0';
      playPauseBtn.style.boxShadow = '0 2px 8px rgba(76, 201, 240, 0.3)';
    }
  }
  
  formatTime(seconds) {
    if (!seconds || seconds < 0 || isNaN(seconds)) return "0:00";
    
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  }
  
  getAudioLevel() {
    return this.audioProcessor.calculateAudioLevel();
  }
  
  showError(message) {
    console.error(`Erro no player ${this.albumKey}:`, message);
  }
  
  destroy() {
    if (this.animationFrameId) {
      cancelAnimationFrame(this.animationFrameId);
    }
    
    if (this.progressInterval) {
      clearInterval(this.progressInterval);
    }
    
    if (this.statusCheckInterval) {
      clearInterval(this.statusCheckInterval);
    }
    
    this.audioProcessor.stop();
  }
}

// Sistema global de gerenciamento
window.AudioDashboard = {
  players: {},
  trackList: [
    { 
      name: "Highway to Hell", 
      artist: "AC/DC", 
      path: "audio/0-AC_DC - Highway to Hell.mp3",
      duration: "3:28",
      image: "image/0image.jpg",
      albumKey: "album1",
      sectionId: "section-album1"
    },
    { 
      name: "It's My Life", 
      artist: "Bon Jovi", 
      path: "audio/1-Bon Jovi - It's my life w_ lyrics.mp3",
      duration: "3:44",
      image: "image/1image.jpg",
      albumKey: "album2",
      sectionId: "section-album2"
    },
    { 
      name: "Livin' On A Prayer", 
      artist: "Bon Jovi", 
      path: "audio/2-Bon Jovi - Livin' On A Prayer.mp3",
      duration: "4:10",
      image: "image/2image.jpg",
      albumKey: "album3",
      sectionId: "section-album3"
    },
  ],
  
  init() {
    console.log('Inicializando Audio Dashboard...');
    
    setTimeout(() => {
      this.players.album1 = new AudioPlayer('canvas1', 'album1', 0);
      this.players.album2 = new AudioPlayer('canvas2', 'album2', 1);
      this.players.album3 = new AudioPlayer('canvas3', 'album3', 2);
      
      console.log('Players inicializados:', this.players);
      
      this.startLevelUpdate();
      this.setupNavigationDropdown();
      this.setupPlayerControls();
    }, 1000);
  },
  
  async playAlbum(albumKey, trackIndex = 0, startTime = 0) {
    console.log(`Tocando ${albumKey}...`);
    
    this.stopAll();
    
    const player = this.players[albumKey];
    if (player && this.trackList[trackIndex]) {
      const track = this.trackList[trackIndex];
      const success = await player.playTrack(track.path, startTime);
      
      if (success) {
        console.log(`Reproduzindo: ${track.name}${startTime > 0 ? ` a partir de ${startTime}s` : ''}`);
        return true;
      }
    }
    return false;
  },
  
  // M√âTODO ATUALIZADO: smartPlayPause agora chama o m√©todo correto
  smartPlayPause(albumKey, startTime = 0) {
    const player = this.players[albumKey];
    if (player) {
      return player.smartPlayPause(startTime);
    }
    return Promise.resolve(false);
  },
  
  restart(albumKey) {
    const player = this.players[albumKey];
    if (player) {
      player.restart();
    }
  },
  
  seekTo(albumKey, time) {
    const player = this.players[albumKey];
    if (player) {
      return player.seekTo(time);
    }
    return Promise.resolve(false);
  },
  
  navigateToAlbum(trackName) {
    const track = this.trackList.find(t => t.name === trackName);
    if (track) {
      const sectionId = track.sectionId;
      const section = document.getElementById(sectionId);
      
      if (section) {
        section.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
        
        section.style.boxShadow = '0 0 0 3px #4cc9f0';
        section.style.transition = 'box-shadow 0.3s';
        
        setTimeout(() => {
          section.style.boxShadow = 'none';
        }, 2000);
        
        console.log(`Navegando para: ${track.name}`);
        return true;
      }
    }
    return false;
  },
  
  stopAll() {
    console.log('Parando todos os players...');
    Object.values(this.players).forEach(player => {
      if (player && typeof player.stop === 'function') {
        player.stop();
      }
    });
  },
  
  setVisualization(albumKey, type) {
    const player = this.players[albumKey];
    if (player) {
      return player.setVisualization(type);
    }
    return false;
  },
  
  setupNavigationDropdown() {
    const select = document.getElementById('globalSongSelect');
    if (select) {
      select.addEventListener('change', (e) => {
        const trackName = e.target.value;
        if (trackName) {
          this.navigateToAlbum(trackName);
          setTimeout(() => {
            select.value = '';
          }, 500);
        }
      });
    }
  },
  
  setupPlayerControls() {
    ['album1', 'album2', 'album3'].forEach(albumKey => {
      const restartBtn = document.getElementById(`restartBtn-${albumKey}`);
      if (restartBtn) {
        restartBtn.addEventListener('click', () => {
          this.restart(albumKey);
        });
      }
    });
  },
  
  startLevelUpdate() {
    setInterval(() => {
      ['album1', 'album2', 'album3'].forEach((albumKey, index) => {
        const player = this.players[albumKey];
        if (player) {
          const level = player.getAudioLevel();
          const barId = `levelBar${index + 1}`;
          const textId = `levelText${index + 1}`;
          
          const bar = document.getElementById(barId);
          const text = document.getElementById(textId);
          
          if (bar && text) {
            bar.style.width = level + '%';
            text.textContent = level + '%';
            bar.style.background = level > 50 ? '#f72585' : level > 20 ? '#ffaa00' : '#4cc9f0';
          }
        }
      });
    }, 100);
  }
};

// Inicializar quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    window.AudioDashboard.init();
  }, 500);
});
</script>

<!-- CSS personalizado -->
<style>
  /* FUNDO TOTALMENTE PRETO */
  body, html, #quarto-dashboard, .dashboard-grid {
    background-color: #000000 !important;
    color: #ffffff !important;
    margin: 0;
    padding: 0;
  }
  
  /* ESTILOS DOS BOT√ïES */
  .viz-control-btn {
    background: #4cc9f0;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background 0.3s;
    margin-right: 5px;
  }
  .viz-control-btn:hover {
    background: #3aa0c0;
  }
  
  .viz-type-btn {
    background: #2a2a4a;
    color: white;
    border: 1px solid #444;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.8em;
    margin: 2px;
    transition: all 0.3s;
  }
  .viz-type-btn:hover {
    background: #3a3a5a;
    border-color: #4cc9f0;
  }
  
  /* CART√ïES DE √ÅLBUM */
  .album-card {
    background: #1a1a3a;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    transition: transform 0.3s, box-shadow 0.3s;
    display: flex;
    align-items: center;
    gap: 20px;
    height: 280px;
    border: 1px solid #333;
  }
  .album-card:hover {
    transform: translateY(-5px);
    border-color: #4cc9f0;
  }
  
  /* MEDIDOR DE N√çVEL */
  .level-meter {
    width: 100%;
    height: 12px;
    background: #2a2a4a;
    border-radius: 6px;
    overflow: hidden;
    margin: 8px 0;
  }
  .level-bar {
    height: 100%;
    background: #4cc9f0;
    transition: width 0.2s;
    width: 0%;
  }
  
  /* BANNER */
  .banner-container {
    box-shadow: 0 4px 20px rgba(0,0,0,0.8);
    border: 1px solid #333;
  }
  
  /* DROPDOWN */
  .form-select {
    background: #2a2a4a !important;
    color: white !important;
    border: 1px solid #444 !important;
    cursor: pointer;
  }
  .form-select:hover {
    border-color: #4cc9f0 !important;
  }
  
  /* CONTAINERS */
  .viz-type-container {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
  }
  
  .canvas-container {
    flex: 1;
    border-radius: 8px;
    overflow: hidden;
    background: #121226;
    min-width: 300px;
    height: 180px;
    border: 1px solid #333;
    position: relative;
  }
  .canvas-container canvas {
    width: 100% !important;
    height: 100% !important;
    display: block;
  }
  
  /* SE√á√ïES DO √ÅLBUM */
  .album-info-section {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-width: 180px;
    height: 100%;
  }
  
  .album-controls-section {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-width: 200px;
    height: 100%;
  }
  
  .section-title {
    color: #aaa;
    font-size: 0.8em;
    margin-bottom: 5px;
    font-weight: bold;
  }
  
  .album-main-info {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .control-buttons-row {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  /* CONTROLES DE REPRODU√á√ÉO - ESTILO SPOTIFY */
  .playback-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #333;
  }
  
  .progress-container {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
  }
  
  .progress-bar-wrapper {
    flex: 1;
    height: 6px;
    background: #2a2a4a;
    border-radius: 3px;
    overflow: hidden;
    cursor: pointer;
    position: relative;
  }
  
  .progress-bar-wrapper:hover {
    height: 8px;
  }
  
  .progress-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: #4cc9f0;
    border-radius: 3px;
    pointer-events: none;
    z-index: 1;
    transition: width 0.1s;
  }
  
  .progress-slider {
    width: 100%;
    height: 100%;
    -webkit-appearance: none;
    appearance: none;
    background: transparent;
    cursor: pointer;
    position: relative;
    z-index: 2;
    opacity: 0;
  }
  
  .progress-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    background: #ffffff;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #4cc9f0;
    box-shadow: 0 0 8px rgba(76, 201, 240, 0.8);
  }
  
  .progress-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: #ffffff;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #4cc9f0;
    box-shadow: 0 0 8px rgba(76, 201, 240, 0.8);
  }
  
  .time-display {
    color: #aaa;
    font-size: 0.75em;
    min-width: 40px;
    text-align: center;
    font-family: monospace;
  }
  
  /* CONTROLES DE PLAY/PAUSE/RESTART */
  .playback-center {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 5px;
  }
  
  .playback-btn {
    width: 36px;
    height: 36px;
    background: #2a2a4a;
    border: none;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .playback-btn:hover {
    background: #3a3a5a;
    transform: scale(1.05);
  }
  
  .playback-btn:active {
    transform: scale(0.95);
  }
  
  .playback-btn i {
    color: white;
    font-size: 1em;
  }
  
  /* Bot√£o Play/Pause espec√≠fico - CORES DIFERENTES PARA PLAY/PAUSE */
  .play-pause-btn {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(76, 201, 240, 0.3);
  }
  
  .play-pause-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(76, 201, 240, 0.4);
  }
  
  .play-pause-btn:active {
    transform: scale(0.95);
  }
  
  .play-pause-btn i {
    color: white;
    font-size: 1.2em;
  }
  
  /* Bot√£o em estado PLAY (azul) */
  .play-pause-btn.play-state {
    background: #4cc9f0;
    box-shadow: 0 2px 8px rgba(76, 201, 240, 0.3);
  }
  
  .play-pause-btn.play-state:hover {
    background: #3aa0c0;
    box-shadow: 0 4px 12px rgba(76, 201, 240, 0.4);
  }
  
  /* Bot√£o em estado PAUSE (vermelho) */
  .play-pause-btn.pause-state {
    background: #f72585;
    box-shadow: 0 2px 8px rgba(247, 37, 133, 0.3);
  }
  
  .play-pause-btn.pause-state:hover {
    background: #d81b6f;
    box-shadow: 0 4px 12px rgba(247, 37, 133, 0.4);
  }
  
  /* Bot√£o Restart */
  .restart-btn {
    background: #2a2a4a;
  }
  
  .restart-btn:hover {
    background: #3a3a5a;
  }
  
  .restart-btn i {
    color: #4cc9f0;
  }
  
  /* DROPDOWN COM "ALL" */
  .dropdown-container {
    display: flex;
    align-items: center;
    gap: 15px;
    width: 100%;
    margin-bottom: 20px;
    background: #1a1a3a;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #333;
  }
  
  .all-label {
    color: #4cc9f0;
    font-weight: bold;
    font-size: 1.1em;
    min-width: 50px;
  }
  
  .dropdown-wrapper {
    flex: 1;
  }
  
  /* CORRE√á√ÉO DE CORES */
  h1, h2, h3, h4, h5, h6, p, span, label {
    color: #ffffff !important;
  }
  
  select, input, textarea {
    background-color: #2a2a4a !important;
    color: #ffffff !important;
    border-color: #444 !important;
  }
  
  a {
    color: #4cc9f0 !important;
  }
  
  hr {
    border-color: #444 !important;
  }
  
  /* MENSAGEM DE NAVEGA√á√ÉO */
  .navigation-hint {
    color: #888;
    font-size: 0.8em;
    margin-top: 5px;
    font-style: italic;
  }
  
  /* NOVO: Indicador de que a barra √© interativa antes de carregar */
  .progress-hint {
    color: #4cc9f0;
    font-size: 0.7em;
    text-align: center;
    margin-top: 5px;
    font-style: italic;
  }
  
  /* ESTILO ESPEC√çFICO PARA O √çCONE PLAY COM OFFSET */
  .play-icon {
    margin-left: 2px;
  }
  
  .pause-icon {
    margin-left: 0px;
  }
</style>

```{ojs}
//| expandable: false
// LAYOUT COMPLETO - COM CONTROLES DE REPRODU√á√ÉO

viewof dashboardLayout = {
  const trackList = [
    { 
      name: "Highway to Hell", 
      artist: "AC/DC", 
      path: "audio/0-AC_DC - Highway to Hell.mp3",
      duration: "3:28",
      image: "image/0image.jpg",
      albumKey: "album1",
      sectionId: "section-album1"
    },
    { 
      name: "It's My Life", 
      artist: "Bon Jovi", 
      path: "audio/1-Bon Jovi - It's my life w_ lyrics.mp3",
      duration: "3:44",
      image: "image/1image.jpg",
      albumKey: "album2",
      sectionId: "section-album2"
    },
    { 
      name: "Livin' On A Prayer", 
      artist: "Bon Jovi", 
      path: "audio/2-Bon Jovi - Livin' On A Prayer.mp3",
      duration: "4:10",
      image: "image/2image.jpg",
      albumKey: "album3",
      sectionId: "section-album3"
    },
  ];
  
  const div = html`
  
  <!-- SE√á√ÉO 1: CARD INFORMATIVO -->
  <div class="banner-container" style="width:100%; height:180px; background: linear-gradient(90deg, #000000 0%, #1a1a3a 100%); border-radius:10px; overflow:hidden; margin-bottom:20px; border:1px solid #333;">
    <div style="display:flex; align-items:center; height:100%; padding:20px;">
      <div style="flex:1; padding:20px;">
        <h2 style="margin:0; color:#4cc9f0; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">Today's Top Hits</h2>
        <p style="color:#aaa; margin-top:10px; font-size:0.9em;">Audio Visualization Dashboard - 3 Independent Players</p>
        <p style="color:#4cc9f0; margin-top:5px; font-size:0.8em; font-weight:bold;">
          <i class="bi bi-check-circle"></i> Sistema inicializado
        </p>
      </div>
      <div style="flex:1; text-align:right;">
        <img src="image/0image.jpg" style="height:140px; border-radius:10px; box-shadow: 0 4px 20px rgba(0,0,0,0.8); border:2px solid #4cc9f0;">
      </div>
    </div>
  </div>
  
  <!-- SE√á√ÉO 2: DROPDOWN COM "ALL" PARA NAVEGA√á√ÉO -->
  <div class="dropdown-container">
    <div class="all-label">All</div>
    <div class="dropdown-wrapper">
      <h5 style="color:#fff; margin-bottom:10px; font-size:0.9em;">Quick Navigation</h5>
      <select id="globalSongSelect" class="form-select">
        <option value="">Select a track to navigate...</option>
        ${trackList.map(track => 
          `<option value="${track.name}">${track.name} - ${track.artist}</option>`
        ).join('')}
      </select>
      <p class="navigation-hint">
        <i class="bi bi-arrow-down-circle"></i> Select a track to jump to its section
      </p>
    </div>
  </div>
  
  <!-- SE√á√ÉO 3: GRID 80%|20% -->
  <div style="display:flex; width:100%; gap:20px; height:calc(100vh - 380px);">
    
    <!-- COLUNA ESQUERDA 80% -->
    <div style="flex:0 0 80%; overflow-y:auto; padding-right:10px;" id="albums-container">
      
      <!-- √ÅLBUM 1 -->
      <div class="album-card" id="section-album1">
        
        <!-- INFO DO √ÅLBUM (DEBAIXO DA CAPA) -->
        <div class="album-info-section">
          <div class="album-main-info">
            <img src="image/0image.jpg" style="width:50px; height:50px; border-radius:8px; margin-right:12px; border:2px solid #4cc9f0;">
            <div>
              <h4 style="margin:0; color:#fff; font-size:1.1em;">Highway to Hell</h4>
              <p style="margin:0; color:#aaa; font-size:0.8em;">AC/DC ‚Ä¢ 3:28</p>
              <p style="margin:5px 0 0 0; color:#4cc9f0; font-size:0.7em;">
                <i class="bi bi-music-note"></i> Album 1
              </p>
            </div>
          </div>
          
          <!-- CONTROLES DE REPRODU√á√ÉO (DEBAIXO DA CAPA) -->
          <div class="playback-controls">
            <div class="progress-container">
              <span class="time-display" id="currentTime-album1">0:00</span>
              <div class="progress-bar-wrapper">
                <div class="progress-fill" id="progressFill-album1" style="width: 0%;"></div>
                <input type="range" id="progressBar-album1" class="progress-slider" min="0" max="100" value="0" step="0.1">
              </div>
              <span class="time-display" id="totalTime-album1">3:28</span>
            </div>
            
            <div class="playback-center">
              <!-- Bot√£o Restart -->
              <button class="playback-btn restart-btn" id="restartBtn-album1" title="Restart to beginning">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
              
              <!-- Bot√£o Play/Pause √öNICO - AGORA COM CORES DIFERENTES -->
              <button class="play-pause-btn play-state" id="playPauseBtn-album1" title="Click to load and play Album 1">
                <i class="bi bi-play-fill play-icon"></i>
              </button>
            </div>
            
            <!-- Mensagem informativa -->
            <p class="progress-hint">
              <i class="bi bi-lightbulb"></i> Click or drag the progress bar to start from any point
            </p>
          </div>
        </div>
        
        <!-- CONTROLES -->
        <div class="album-controls-section">
          <div>
            <div class="section-title">Visualization Type</div>
            <div class="viz-type-container">
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album1', 'spectrum')">üìä Spectrum</button>
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album1', 'waveform')">„Ä∞Ô∏è Waveform</button>
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album1', 'particles')">‚ú® Particles</button>
            </div>
          </div>
          
          <!-- MEDIDOR DE N√çVEL (DEBAIXO DO CANVAS) -->
          <div style="margin-top: 15px;">
            <div class="section-title">Audio Level</div>
            <div class="level-meter">
              <div id="levelBar1" class="level-bar"></div>
            </div>
            <p id="levelText1" style="margin:0; color:#aaa; font-size:0.75em; text-align:right;">0%</p>
          </div>
        </div>
        
        <!-- CANVAS (NO MESMO S√çTIO) -->
        <div class="canvas-container">
          <canvas id="canvas1" width="400" height="200"></canvas>
        </div>
        
      </div>
      
      <!-- √ÅLBUM 2 -->
      <div class="album-card" id="section-album2">
        
        <div class="album-info-section">
          <div class="album-main-info">
            <img src="image/1image.jpg" style="width:50px; height:50px; border-radius:8px; margin-right:12px; border:2px solid #4cc9f0;">
            <div>
              <h4 style="margin:0; color:#fff; font-size:1.1em;">It's My Life</h4>
              <p style="margin:0; color:#aaa; font-size:0.8em;">Bon Jovi ‚Ä¢ 3:44</p>
              <p style="margin:5px 0 0 0; color:#4cc9f0; font-size:0.7em;">
                <i class="bi bi-music-note"></i> Album 2
              </p>
            </div>
          </div>
          
          <!-- CONTROLES DE REPRODU√á√ÉO -->
          <div class="playback-controls">
            <div class="progress-container">
              <span class="time-display" id="currentTime-album2">0:00</span>
              <div class="progress-bar-wrapper">
                <div class="progress-fill" id="progressFill-album2" style="width: 0%;"></div>
                <input type="range" id="progressBar-album2" class="progress-slider" min="0" max="100" value="0" step="0.1">
              </div>
              <span class="time-display" id="totalTime-album2">3:44</span>
            </div>
            
            <div class="playback-center">
              <!-- Bot√£o Restart -->
              <button class="playback-btn restart-btn" id="restartBtn-album2" title="Restart to beginning">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
              
              <!-- Bot√£o Play/Pause √öNICO -->
              <button class="play-pause-btn play-state" id="playPauseBtn-album2" title="Click to load and play Album 2">
                <i class="bi bi-play-fill play-icon"></i>
              </button>
            </div>
            
            <!-- Mensagem informativa -->
            <p class="progress-hint">
              <i class="bi bi-lightbulb"></i> Click or drag the progress bar to start from any point
            </p>
          </div>
        </div>
        
        <div class="album-controls-section">
          <div>
            <div class="section-title">Visualization Type</div>
            <div class="viz-type-container">
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album2', 'spectrum')">üìä Spectrum</button>
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album2', 'waveform')">„Ä∞Ô∏è Waveform</button>
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album2', 'particles')">‚ú® Particles</button>
            </div>
          </div>
          
          <!-- MEDIDOR DE N√çVEL (DEBAIXO DO CANVAS) -->
          <div style="margin-top: 15px;">
            <div class="section-title">Audio Level</div>
            <div class="level-meter">
              <div id="levelBar2" class="level-bar"></div>
            </div>
            <p id="levelText2" style="margin:0; color:#aaa; font-size:0.75em; text-align:right;">0%</p>
          </div>
        </div>
        
        <div class="canvas-container">
          <canvas id="canvas2" width="400" height="200"></canvas>
        </div>
        
      </div>
      
      <!-- √ÅLBUM 3 -->
      <div class="album-card" id="section-album3">
        
        <div class="album-info-section">
          <div class="album-main-info">
            <img src="image/2image.jpg" style="width:50px; height:50px; border-radius:8px; margin-right:12px; border:2px solid #4cc9f0;">
            <div>
              <h4 style="margin:0; color:#fff; font-size:1.1em;">Livin' On A Prayer</h4>
              <p style="margin:0; color:#aaa; font-size:0.8em;">Bon Jovi ‚Ä¢ 4:10</p>
              <p style="margin:5px 0 0 0; color:#4cc9f0; font-size:0.7em;">
                <i class="bi bi-music-note"></i> Album 3
              </p>
            </div>
          </div>
          
          <!-- CONTROLES DE REPRODU√á√ÉO -->
          <div class="playback-controls">
            <div class="progress-container">
              <span class="time-display" id="currentTime-album3">0:00</span>
              <div class="progress-bar-wrapper">
                <div class="progress-fill" id="progressFill-album3" style="width: 0%;"></div>
                <input type="range" id="progressBar-album3" class="progress-slider" min="0" max="100" value="0" step="0.1">
              </div>
              <span class="time-display" id="totalTime-album3">4:10</span>
            </div>
            
            <div class="playback-center">
              <!-- Bot√£o Restart -->
              <button class="playback-btn restart-btn" id="restartBtn-album3" title="Restart to beginning">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
              
              <!-- Bot√£o Play/Pause √öNICO -->
              <button class="play-pause-btn play-state" id="playPauseBtn-album3" title="Click to load and play Album 3">
                <i class="bi bi-play-fill play-icon"></i>
              </button>
            </div>
            
            <!-- Mensagem informativa -->
            <p class="progress-hint">
              <i class="bi bi-lightbulb"></i> Click or drag the progress bar to start from any point
            </p>
          </div>
        </div>
        
        <div class="album-controls-section">
          <div>
            <div class="section-title">Visualization Type</div>
            <div class="viz-type-container">
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album3', 'spectrum')">üìä Spectrum</button>
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album3', 'waveform')">„Ä∞Ô∏è Waveform</button>
              <button class="viz-type-btn" onclick="window.AudioDashboard.setVisualization('album3', 'particles')">‚ú® Particles</button>
            </div>
          </div>
          
          <!-- MEDIDOR DE N√çVEL (DEBAIXO DO CANVAS) -->
          <div style="margin-top: 15px;">
            <div class="section-title">Audio Level</div>
            <div class="level-meter">
              <div id="levelBar3" class="level-bar"></div>
            </div>
            <p id="levelText3" style="margin:0; color:#aaa; font-size:0.75em; text-align:right;">0%</p>
          </div>
        </div>
        
        <div class="canvas-container">
          <canvas id="canvas3" width="400" height="200"></canvas>
        </div>
        
      </div>
      
    </div>
    
    <!-- COLUNA DIREITA 20% -->
    <div style="flex:0 0 20%; overflow-y:auto;">
      
      <!-- Stats Card -->
      <div style="background:#1a1a3a; border-radius:10px; padding:20px; margin-bottom:20px; border:1px solid #333;">
        <h5 style="color:#fff; margin-bottom:15px; font-size:1em;">Dashboard Stats</h5>
        <h1 style="color:#4cc9f0; margin:0; font-size:2.2em; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">9,624</h1>
        <p style="color:#aaa; margin:5px 0 20px 0; font-size:0.9em;">Total Followers</p>
        
        <hr style="border-color:#444; margin:15px 0;">
        
        <div style="margin-bottom:15px;">
          <p style="margin:0 0 10px 0; display:flex; justify-content:space-between; font-size:0.9em;">
            <span style="color:#fff;">Following</span>
            <span style="color:#aaa;">0</span>
          </p>
          <p style="margin:0 0 10px 0; display:flex; justify-content:space-between; font-size:0.9em;">
            <span style="color:#fff;">Active Tracks</span>
            <span style="color:#aaa;">${trackList.length}</span>
          </p>
          <p style="margin:0; display:flex; justify-content:space-between; font-size:0.9em;">
            <span style="color:#fff;">Playlists</span>
            <span style="color:#aaa;">5</span>
          </p>
        </div>
        
        <hr style="border-color:#444; margin:15px 0;">
        
        <h6 style="color:#fff; margin-bottom:10px; font-size:0.9em;">Social Media</h6>
        <div>
          <a href="#" style="display:flex; align-items:center; color:#aaa; text-decoration:none; margin-bottom:8px; padding:8px; border-radius:5px; background:#2a2a4a; font-size:0.9em; transition:all 0.3s;" 
             onmouseover="this.style.color='#4cc9f0'; this.style.background='#3a3a5a';" 
             onmouseout="this.style.color='#aaa'; this.style.background='#2a2a4a';">
            <i class="bi bi-instagram" style="margin-right:10px; font-size:1.1em;"></i>
            <span>Instagram</span>
          </a>
          <a href="#" style="display:flex; align-items:center; color:#aaa; text-decoration:none; margin-bottom:8px; padding:8px; border-radius:5px; background:#2a2a4a; font-size:0.9em; transition:all 0.3s;"
             onmouseover="this.style.color='#4cc9f0'; this.style.background='#3a3a5a';" 
             onmouseout="this.style.color='#aaa'; this.style.background='#2a2a4a';">
            <i class="bi bi-youtube" style="margin-right:10px; font-size:1.1em;"></i>
            <span>YouTube</span>
          </a>
          <a href="#" style="display:flex; align-items:center; color:#aaa; text-decoration:none; margin-bottom:8px; padding:8px; border-radius:5px; background:#2a2a4a; font-size:0.9em; transition:all 0.3s;"
             onmouseover="this.style.color='#4cc9f0'; this.style.background='#3a3a5a';" 
             onmouseout="this.style.color='#aaa'; this.style.background='#2a2a4a';">
            <i class="bi bi-twitter" style="margin-right:10px; font-size:1.1em;"></i>
            <span>Twitter</span>
          </a>
          <a href="#" style="display:flex; align-items:center; color:#aaa; text-decoration:none; padding:8px; border-radius:5px; background:#2a2a4a; font-size:0.9em; transition:all 0.3s;"
             onmouseover="this.style.color='#4cc9f0'; this.style.background='#3a3a5a';" 
             onmouseout="this.style.color='#aaa'; this.style.background='#2a2a4a';">
            <i class="bi bi-tiktok" style="margin-right:10px; font-size:1.1em;"></i>
            <span>TikTok</span>
          </a>
        </div>
      </div>
      
      <!-- Global Controls -->
      <div style="background:#1a1a3a; border-radius:10px; padding:20px; border:1px solid #333;">
        <h5 style="color:#fff; margin-bottom:15px; font-size:1em;">Global Controls</h5>
        
        <div style="margin-bottom:15px;">
          <p style="color:#fff; margin-bottom:8px; font-size:0.85em;">Stop All Players:</p>
          <button class="viz-control-btn" onclick="window.AudioDashboard.stopAll()" style="width:100%; background:#f72585;">üõë Stop All Audio</button>
        </div>
        
        <hr style="border-color:#444; margin:15px 0;">
        
        <div>
          <p style="color:#fff; margin-bottom:8px; font-size:0.85em;">Quick Play (Load & Play):</p>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button class="viz-type-btn" onclick="window.AudioDashboard.smartPlayPause('album1')" style="text-align:center; background:#4cc9f0; color:white; border:none;">‚ñ∂ Highway to Hell</button>
            <button class="viz-type-btn" onclick="window.AudioDashboard.smartPlayPause('album2')" style="text-align:center; background:#4cc9f0; color:white; border:none;">‚ñ∂ It's My Life</button>
            <button class="viz-type-btn" onclick="window.AudioDashboard.smartPlayPause('album3')" style="text-align:center; background:#4cc9f0; color:white; border:none;">‚ñ∂ Livin' On A Prayer</button>
          </div>
        </div>
        
        <hr style="border-color:#444; margin:15px 0;">
        
        <div>
          <p style="color:#fff; margin-bottom:8px; font-size:0.85em;">Quick Navigation:</p>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button class="viz-type-btn" onclick="window.AudioDashboard.navigateToAlbum('Highway to Hell')" style="text-align:center; background:#2a2a4a; color:white; border:1px solid #444;">üìç Album 1</button>
            <button class="viz-type-btn" onclick="window.AudioDashboard.navigateToAlbum('It\'s My Life')" style="text-align:center; background:#2a2a4a; color:white; border:1px solid #444;">üìç Album 2</button>
            <button class="viz-type-btn" onclick="window.AudioDashboard.navigateToAlbum('Livin\' On A Prayer')" style="text-align:center; background:#2a2a4a; color:white; border:1px solid #444;">üìç Album 3</button>
          </div>
        </div>
      </div>
      
    </div>
    
  </div>
  `;
  
  return div;
}
```